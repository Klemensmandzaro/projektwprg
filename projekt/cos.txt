<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
            td{
                border: 1px solid black;
                text-align: center;
                width: 9%;
                height: 5%;
            }
    </style>
    <title>Document</title>
</head>
<body>
    
    <div>
    
        <?php
            
            if (isset($_POST['zaloguj']))
            {
                include 'logowanie.php';
                session_destroy();
                if ($_SESSION['logging']==false)
                {
                    echo '<form method="POST">
                
                    <input type="submit" name="zarejestruj" value="zarejestruj">
                    </form>';
                }
                
            }
            else if (isset($_POST['zarejestruj']))
            {
                include 'zarejestruj.php';
                echo '<form method="POST">
                <input type="submit" name="zaloguj" value="zaloguj">
                
            </form>';
                
            }
            else
            {
                
                //$_SESSION['logging']=false;
                echo '<form method="POST">
                <input type="submit" name="zaloguj" value="zaloguj">
                <input type="submit" name="zarejestruj" value="zarejestruj">
            </form>';
            }
            
            
            
        ?>
        <table id="calendar">
            <thead>
            <tr>
            <td><button id="prev">←</button></td>
            <td colspan="5" id="calendar_top"></td>
            <td><button id="next">→</button></td>
            </tr><tr><td>pon</td><td>wto</td><td>śr</td><td>czw</td><td>pią</td><td>sob</td><td>nie</td></tr></thead>
            <tbody>
            <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr>
            </tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr>
            </tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr>
            </tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr>
            </tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr>
            </tr><tr><td style="display: none;"></td><td style="display: none;"></td><td style="display: none;"></td><td style="display: none;"></td><td style="display: none;"></td><td style="display: none;"></td><td style="display: none;"></td></tr><tr>
            </tr></tbody>
            </table>

            <script>

            var aMonths = new Array('styczeń','luty','marzec','kwiecień','maj','czerwiec','lipiec','sierpień','wrzesień','październik','listopad','grudzień');
            var date    = new Date();

            Calendar();

            document.querySelector('#prev').addEventListener('click',PrevMonth);
            document.querySelector('#next').addEventListener('click',NextMonth);

            function PrevMonth(){
            date = new Date(date.getFullYear(), date.getMonth() - 1, 1);
            Calendar();
            }

            function NextMonth(){
            date = new Date(date.getFullYear(), date.getMonth() + 1, 1);
            Calendar();
            }

            function Calendar(){

            const   td       = document.querySelectorAll('#calendar tbody td');
            const   firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const   lastDay  = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            const   day      = firstDay.getDay() ? firstDay.getDay()-1 : 6;

            document.querySelector('#calendar_top').innerHTML = aMonths[date.getMonth()] + ' ' + date.getFullYear();

            let dzien = 1;
            for (let i = 0; i < td.length; i++) {
            td[i].innerHTML = (i >= day && dzien <= lastDay.getDate())
                ? '<button id="btnDzien-' + i + '" value="' + dzien + '" onclick="getSelectedDay(this)">' + (dzien++) + '</button>' // Use dzien+1 to display actual day
                : '';
            if (i >= 35) td[i].style.display = (day + dzien - 1 < 36) ? 'none' : ''; // hiding last row
            }
            }

                function getSelectedDay(button) {
                    const selectedDay = parseInt(button.value);
                    const selectedMonth = aMonths[date.getMonth()];
                    const selectedYear = date.getFullYear();
                    // You can now use the selectedDay variable for further processing
                    console.log("Selected Day:", selectedDay);
                    console.log("Selected Day:", selectedMonth);
                    console.log("Selected Day:", selectedYear);
                    const mail=document.getElementById("mail").innerHTML;
                    console.log(mail);
                    const xhr = new XMLHttpRequest();
                        xhr.open('POST', 'główna.php');
                        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                        xhr.onload = function() {
                            if (xhr.status === 200) {
                            console.log('Day sent to server:', selectedDay);
                            } else {
                            console.error('Error sending day:', xhr.statusText);
                            }
                        };

                    const data = {
                    selectedDay: selectedDay,
                    selectedMonth: selectedMonth,
                    selectedYear: selectedYear
                    };

                    xhr.send(JSON.stringify(data));
                }

                
                

            </script>
            <?php
            
                // Connect to MySQL database
                $db = new mysqli('localhost', 'root', '', 'projekt');
                // Check connection
                if ($db->connect_error) {
                die('Connection failed: ' . $db->connect_error);
                }
                // Get selected day from POST request
                $data = json_decode(file_get_contents('php://input'), true);

                // Extract data from the received JSON object
                $selectedDay = $_POST['data'];
                $selectedDay = $data['selectedDay'];
                $selectedMonth = $data['selectedMonth'];
                $selectedYear = $data['selectedYear'];
                $mail=$_SESSION['mail'];
                echo 'ssssssssssssssssssssss';
                var_dump($selectedDay);
                // Insert selected day into the database
                $sql = "INSERT INTO dzien (dzien, miesiac, rok, mail) VALUES ($selectedDay, $selectedMonth, $selectedYear,$mail)";
                if ($db->query($sql) === TRUE) {
                echo "Day inserted successfully";
                } else {
                echo "Error inserting day: " . $db->error;
                }

                // Close database connection
                $db->close();
                            
                ?>
            
        
    
</body>
</html>